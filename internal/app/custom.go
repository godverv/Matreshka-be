// Code generated by RedSock CLI.
// DO EDIT, DON'T DELETE THIS FILE.

package app

import (
	"net/http"

	"github.com/godverv/matreshka-be/internal/data"
	"github.com/godverv/matreshka-be/internal/data/storage"
	"github.com/godverv/matreshka-be/internal/service"
	v1 "github.com/godverv/matreshka-be/internal/service/servicev1"
	"github.com/godverv/matreshka-be/internal/transport/grpc"
	"github.com/godverv/matreshka-be/internal/transport/web_client"
)

type Custom struct {
	DataProvider data.Data

	Srv service.ConfigService

	GrpcImpl  *grpc.Impl
	WebClient http.Handler
}

func (c *Custom) Init(a *App) (err error) {
	// Repository, Service logic, transport registration happens here
	c.DataProvider, err = storage.New(a.Sqlite)

	c.Srv = v1.New(c.DataProvider)

	c.GrpcImpl = grpc.NewServer(a.Cfg, c.Srv, c.DataProvider)

	a.Server.AddGrpcServer(c.GrpcImpl)

	c.WebClient = web_client.NewServer()
	a.Server.AddHttpHandler("/", c.WebClient)
	return nil
}
